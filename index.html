<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>‡∏™‡∏°‡∏∏‡∏î‡∏à‡∏î‡∏´‡∏ß‡∏¢‡∏≠‡∏≠‡∏ü‡πÑ‡∏•‡∏ô‡πå</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <meta name="theme-color" content="#0d6efd">
  <link rel="manifest" href="manifest.webmanifest">

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500;600&display=swap" rel="stylesheet">

  <style>
    body {
      font-family: "Prompt", sans-serif;
      background: #f5f7fb;
    }
    .navbar {
      background: linear-gradient(135deg, #4c6fff, #6b9dff);
    }
    .navbar-brand {
      color: #fff !important;
      font-weight: 500;
    }
    .nav-link {
      color: #e0e7ff !important;
    }
    .card {
      border-radius: 1rem;
      box-shadow: 0 10px 25px rgba(15, 23, 42, 0.1);
      border: none;
    }
    .section {
      display: none;
    }
    .section.active {
      display: block;
    }
    .pill {
      border-radius: 999px;
    }
  </style>
</head>
<body>
<nav class="navbar navbar-expand-lg mb-3">
  <div class="container">
    <a class="navbar-brand" href="#">üìí ‡∏™‡∏°‡∏∏‡∏î‡∏à‡∏î‡∏´‡∏ß‡∏¢</a>
    <ul class="navbar-nav ms-auto">
      <li class="nav-item">
        <button class="btn btn-sm btn-light me-2" onclick="showSection('people')">‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠</button>
      </li>
      <li class="nav-item">
        <button class="btn btn-sm btn-light me-2" onclick="showSection('records')">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏•‡∏Ç</button>
      </li>
      <li class="nav-item">
        <button class="btn btn-sm btn-warning" onclick="showSection('check')">‡∏ï‡∏£‡∏ß‡∏à‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•</button>
      </li>
    </ul>
  </div>
</nav>

<div class="container mb-4">

  <!-- ‡∏™‡πà‡∏ß‡∏ô‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏ô -->
  <div id="section-people" class="section active">
    <div class="row g-4">
      <div class="col-md-6">
        <div class="card p-3">
          <div class="card-body">
            <h5 class="card-title mb-3">‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏à‡∏î‡πÄ‡∏•‡∏Ç</h5>
            <ul id="person-list" class="list-group small"></ul>
          </div>
        </div>
      </div>
      <div class="col-md-6">
        <div class="card p-3">
          <div class="card-body">
            <h5 class="card-title mb-3">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡πÉ‡∏´‡∏°‡πà</h5>
            <form onsubmit="addPerson(event)">
              <div class="mb-2">
                <label class="form-label">‡∏ä‡∏∑‡πà‡∏≠</label>
                <input type="text" id="person-name" class="form-control" required>
              </div>
              <div class="mb-2">
                <label class="form-label">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</label>
                <input type="text" id="person-note" class="form-control">
              </div>
              <button type="submit" class="btn btn-primary w-100">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- ‡∏™‡πà‡∏ß‡∏ô‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏•‡∏Ç -->
  <div id="section-records" class="section">
    <div class="row g-4">
      <div class="col-md-5">
        <div class="card p-3">
          <div class="card-body">
            <h5 class="card-title mb-3">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏•‡∏Ç‡πÉ‡∏´‡∏°‡πà</h5>
            <form onsubmit="addRecord(event)">
              <div class="mb-2">
                <label class="form-label">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠</label>
                <select id="record-person-id" class="form-select" required></select>
              </div>
              <div class="mb-2">
                <label class="form-label">‡∏á‡∏ß‡∏î‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)</label>
                <input type="date" id="record-date" class="form-control">
              </div>
              <div class="mb-2">
                <label class="form-label">‡πÄ‡∏•‡∏Ç</label>
                <input type="text" id="record-number" class="form-control" maxlength="3" placeholder="‡πÄ‡∏ä‡πà‡∏ô 23 ‡∏´‡∏£‡∏∑‡∏≠ 123" required>
              </div>
              <div class="mb-2">
                <label class="form-label">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏´‡∏•‡∏±‡∏Å</label>
                <select id="record-digits" class="form-select">
                  <option value="2">2 ‡∏ï‡∏±‡∏ß</option>
                  <option value="3" selected>3 ‡∏ï‡∏±‡∏ß</option>
                </select>
              </div>
              <div class="mb-2">
                <label class="form-label">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</label>
                <select id="record-bettype" class="form-select">
                  <option value="‡∏ö‡∏ô">‡∏ö‡∏ô</option>
                  <option value="‡∏•‡πà‡∏≤‡∏á">‡∏•‡πà‡∏≤‡∏á</option>
                  <option value="‡πÇ‡∏ï‡πä‡∏î">‡πÇ‡∏ï‡πä‡∏î</option>
                  <option value="‡∏≠‡∏∑‡πà‡∏ô‡πÜ">‡∏≠‡∏∑‡πà‡∏ô‡πÜ</option>
                </select>
              </div>
              <div class="mb-2">
                <label class="form-label">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏‡πÄ‡∏û‡∏¥‡πà‡∏°</label>
                <input type="text" id="record-remark" class="form-control">
              </div>
              <button type="submit" class="btn btn-success w-100 mt-2">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏•‡∏Ç</button>
            </form>
          </div>
        </div>
      </div>

      <div class="col-md-7">
        <div class="card p-3">
          <div class="card-body">
            <h5 class="card-title mb-3">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</h5>
            <div class="mb-2">
              <label class="form-label small">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ñ‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏£‡∏≠‡∏á</label>
              <select id="filter-person-id" class="form-select form-select-sm" onchange="renderRecordList()">
              </select>
            </div>
            <div class="table-responsive" style="max-height: 400px; overflow:auto;">
              <table class="table table-sm align-middle">
                <thead class="table-light">
                  <tr>
                    <th>‡∏ä‡∏∑‡πà‡∏≠</th>
                    <th>‡∏á‡∏ß‡∏î‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th>
                    <th>‡πÄ‡∏•‡∏Ç</th>
                    <th>‡∏´‡∏•‡∏±‡∏Å</th>
                    <th>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</th>
                    <th>‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</th>
                  </tr>
                </thead>
                <tbody id="record-list"></tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- ‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏£‡∏ß‡∏à‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏• -->
  <div id="section-check" class="section">
    <div class="row g-4">
      <div class="col-md-4">
        <div class="card p-3">
          <div class="card-body">
            <h5 class="card-title mb-3">‡∏ï‡∏£‡∏ß‡∏à‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•</h5>
            <form onsubmit="checkWinners(event)">
              <div class="mb-2">
                <label class="form-label">‡∏á‡∏ß‡∏î‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà (‡∏ñ‡πâ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏≠‡∏á)</label>
                <input type="date" id="check-date" class="form-control">
              </div>
              <div class="mb-2">
                <label class="form-label">‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏≠‡∏≠‡∏Å</label>
                <input type="text" id="check-number" class="form-control" maxlength="3" placeholder="‡πÄ‡∏ä‡πà‡∏ô 23 ‡∏´‡∏£‡∏∑‡∏≠ 123" required>
              </div>
              <div class="mb-2">
                <label class="form-label">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏´‡∏•‡∏±‡∏Å</label>
                <select id="check-digits" class="form-select">
                  <option value="2">2 ‡∏ï‡∏±‡∏ß</option>
                  <option value="3" selected>3 ‡∏ï‡∏±‡∏ß</option>
                </select>
              </div>
              <div class="mb-2">
                <label class="form-label">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</label>
                <select id="check-bettype" class="form-select">
                  <option value="‡∏ö‡∏ô">‡∏ö‡∏ô</option>
                  <option value="‡∏•‡πà‡∏≤‡∏á">‡∏•‡πà‡∏≤‡∏á</option>
                  <option value="‡πÇ‡∏ï‡πä‡∏î">‡πÇ‡∏ï‡πä‡∏î</option>
                  <option value="‡∏≠‡∏∑‡πà‡∏ô‡πÜ">‡∏≠‡∏∑‡πà‡∏ô‡πÜ</option>
                </select>
              </div>
              <button type="submit" class="btn btn-primary w-100 mt-2">‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å</button>
            </form>
          </div>
        </div>
      </div>

      <div class="col-md-8">
        <div class="card p-3">
          <div class="card-body">
            <h5 class="card-title mb-3">‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</h5>
            <p class="small text-muted" id="check-summary"></p>
            <div class="table-responsive" style="max-height: 400px; overflow:auto;">
              <table class="table table-sm align-middle">
                <thead class="table-light">
                  <tr>
                    <th>‡∏ä‡∏∑‡πà‡∏≠</th>
                    <th>‡∏á‡∏ß‡∏î‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th>
                    <th>‡πÄ‡∏•‡∏Ç</th>
                    <th>‡∏´‡∏•‡∏±‡∏Å</th>
                    <th>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</th>
                    <th>‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</th>
                  </tr>
                </thead>
                <tbody id="check-result-list"></tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

</div>

<script>
  // --------- PWA Service Worker Registration ----------
  if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => {
      navigator.serviceWorker.register('sw.js').catch(err => {
        console.log('SW reg error', err);
      });
    });
  }

  // --------- Data State & Storage ----------
  let state = {
    persons: [],
    records: [],
    nextPersonId: 1,
    nextRecordId: 1
  };

  function loadState() {
    const raw = localStorage.getItem('lottoState');
    if (raw) {
      try {
        const obj = JSON.parse(raw);
        state = obj;
      } catch (e) {
        console.error('load error', e);
      }
    }
  }

  function saveState() {
    localStorage.setItem('lottoState', JSON.stringify(state));
  }

  // --------- UI Switch Sections ----------
  function showSection(name) {
    document.querySelectorAll('.section').forEach(sec => sec.classList.remove('active'));
    document.getElementById('section-' + name).classList.add('active');
  }

  // --------- Persons ----------
  function renderPersonList() {
    const ul = document.getElementById('person-list');
    ul.innerHTML = '';
    if (state.persons.length === 0) {
      ul.innerHTML = '<li class="list-group-item text-muted">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠</li>';
      return;
    }
    state.persons.forEach(p => {
      const li = document.createElement('li');
      li.className = 'list-group-item d-flex justify-content-between align-items-center';
      li.innerHTML = `
        <div>
          <strong>${p.name}</strong>
          ${p.note ? `<div class="small text-muted">${p.note}</div>` : ''}
        </div>
        <span class="badge bg-primary pill">
          ${state.records.filter(r => r.personId === p.id).length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£
        </span>
      `;
      ul.appendChild(li);
    });

    // dropdowns
    const selRecord = document.getElementById('record-person-id');
    const selFilter = document.getElementById('filter-person-id');
    [selRecord, selFilter].forEach(sel => { sel.innerHTML = ''; });

    const defaultOpt = document.createElement('option');
    defaultOpt.value = '';
    defaultOpt.textContent = '‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠...';
    selRecord.appendChild(defaultOpt);

    const allOpt = document.createElement('option');
    allOpt.value = '';
    allOpt.textContent = '‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô';
    selFilter.appendChild(allOpt);

    state.persons.forEach(p => {
      const o1 = document.createElement('option');
      o1.value = p.id;
      o1.textContent = p.name;
      selRecord.appendChild(o1);

      const o2 = document.createElement('option');
      o2.value = p.id;
      o2.textContent = p.name;
      selFilter.appendChild(o2);
    });
  }

  function addPerson(e) {
    e.preventDefault();
    const name = document.getElementById('person-name').value.trim();
    const note = document.getElementById('person-note').value.trim();
    if (!name) return;

    state.persons.push({
      id: state.nextPersonId++,
      name,
      note
    });
    saveState();
    renderPersonList();
    document.getElementById('person-name').value = '';
    document.getElementById('person-note').value = '';
    alert('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢');
  }

  // --------- Records ----------
  function renderRecordList() {
    const tbody = document.getElementById('record-list');
    tbody.innerHTML = '';
    if (state.records.length === 0) {
      tbody.innerHTML = '<tr><td colspan="6" class="text-muted">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏Ç</td></tr>';
      return;
    }
    const filterId = parseInt(document.getElementById('filter-person-id').value || '0', 10);

    // ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏°‡∏≤‡∏Å‡πà‡∏≠‡∏ô
    const records = [...state.records].sort((a, b) => b.id - a.id);

    records.forEach(r => {
      if (filterId && r.personId !== filterId) return;
      const p = state.persons.find(p => p.id === r.personId);
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${p ? p.name : '-'}</td>
        <td>${r.drawDate || '-'}</td>
        <td>${r.number}</td>
        <td>${r.digits}</td>
        <td>${r.betType}</td>
        <td>${r.remark || ''}</td>
      `;
      tbody.appendChild(tr);
    });
  }

  function addRecord(e) {
    e.preventDefault();
    const personId = parseInt(document.getElementById('record-person-id').value || '0', 10);
    const drawDate = document.getElementById('record-date').value || '';
    const number = document.getElementById('record-number').value.trim();
    const digits = parseInt(document.getElementById('record-digits').value, 10);
    const betType = document.getElementById('record-bettype').value;
    const remark = document.getElementById('record-remark').value.trim();

    if (!personId) {
      alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠');
      return;
    }
    if (!number) {
      alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏•‡∏Ç');
      return;
    }
    if (digits === 2 && number.length !== 2) {
      alert('‡πÄ‡∏•‡∏∑‡∏≠‡∏Å 2 ‡∏ï‡∏±‡∏ß ‡πÅ‡∏ï‡πà‡∏Å‡∏£‡∏≠‡∏Å‡πÑ‡∏°‡πà‡∏Ñ‡∏£‡∏ö 2 ‡∏´‡∏•‡∏±‡∏Å');
      return;
    }
    if (digits === 3 && number.length !== 3) {
      alert('‡πÄ‡∏•‡∏∑‡∏≠‡∏Å 3 ‡∏ï‡∏±‡∏ß ‡πÅ‡∏ï‡πà‡∏Å‡∏£‡∏≠‡∏Å‡πÑ‡∏°‡πà‡∏Ñ‡∏£‡∏ö 3 ‡∏´‡∏•‡∏±‡∏Å');
      return;
    }

    state.records.push({
      id: state.nextRecordId++,
      personId,
      drawDate,
      number,
      digits,
      betType,
      remark
    });
    saveState();
    renderRecordList();
    renderPersonList(); // update count

    document.getElementById('record-number').value = '';
    document.getElementById('record-remark').value = '';

    alert('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏•‡∏Ç‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢');
  }

  // --------- Check Winners ----------
  function checkWinners(e) {
    e.preventDefault();
    const drawDate = document.getElementById('check-date').value || '';
    const number = document.getElementById('check-number').value.trim();
    const digits = parseInt(document.getElementById('check-digits').value, 10);
    const betType = document.getElementById('check-bettype').value;

    if (!number) {
      alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏≠‡∏≠‡∏Å');
      return;
    }

    let results = state.records.filter(r => {
      if (drawDate && r.drawDate !== drawDate) return false;
      if (r.digits !== digits) return false;
      if (r.number !== number) return false;
      if (r.betType !== betType) return false;
      return true;
    });

    const tbody = document.getElementById('check-result-list');
    tbody.innerHTML = '';

    if (results.length === 0) {
      tbody.innerHTML = '<tr><td colspan="6" class="text-muted">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÉ‡∏Ñ‡∏£‡∏ñ‡∏π‡∏Å‡πÄ‡∏•‡∏Ç‡∏ô‡∏µ‡πâ</td></tr>';
    } else {
      results.forEach(r => {
        const p = state.persons.find(p => p.id === r.personId);
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td><span class="badge bg-success pill">${p ? p.name : '-'}</span></td>
          <td>${r.drawDate || '-'}</td>
          <td><strong>${r.number}</strong></td>
          <td>${r.digits}</td>
          <td>${r.betType}</td>
          <td>${r.remark || ''}</td>
        `;
        tbody.appendChild(tr);
      });
    }

    const summary = document.getElementById('check-summary');
    summary.textContent = `‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏≠‡∏≠‡∏Å: ${number} (${digits} ‡∏ï‡∏±‡∏ß, ${betType}) ` +
      (drawDate ? `‡∏á‡∏ß‡∏î‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà ${drawDate}` : '');
  }

  // --------- Init ----------
  loadState();
  renderPersonList();
  renderRecordList();
</script>

</body>
</html>
